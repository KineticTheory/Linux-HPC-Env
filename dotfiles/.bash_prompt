#!/bin/bash

if test "$INTERACTIVE" = true; then


  if [[ $(uname -m) == "x86_64" ]]; then
    plg="powerline-go"
  elif [[ $(uname -m) == "aarch64" ]]; then
    plg="powerline-go-linux-arm64"
  else
    plg="unknown"
  fi

  if [[ "${plg}" != "unknown" ]]; then

  # pragma once
  if [[ `type bash_prompt_pragma_once 2>&1 | grep -c "bash: type: "` != 0 ]]; then
    function bash_prompt_pragma_once () {
      echo "bppo"
    }
    [[ "${verbose:=false}" == "true" ]] && echo "in ~/.bash_prompt"
  fi

  #------------------------------------------------------------------------------#

  if [[ -x /usr/projects/draco/vendors/go/bin/${plg} ]]; then
    GOPATH=/usr/projects/draco/vendors/go
    function _update_ps1() {
      # see options by running 'powerline-go -h'
      # https://github.com/justjanne/powerline-go
      # theme opts: {default, low-contrast, gruvbox, solarized-dark16, solarized-light16}
      # might need '-mode compatible
      PS1="$($GOPATH/bin/${plg} -theme default -error $?)"
    }
    if [ "$TERM" != "linux" ] && [ -f "$GOPATH/bin/powerline-go" ]; then
      PROMPT_COMMAND="_update_ps1; $PROMPT_COMMAND"
    fi
  fi

#------------------------------------------------------------------------------#
    [[ "${verbose:=false}" == "true" ]] && echo "in ~/.bash_prompt ... done"
  fi
fi
