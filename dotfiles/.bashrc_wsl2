# .bashrc_wls
#
# .bashrc_wls is sourced by interactive shells from .bash_profile and .bashrc
#
# Customize these settings to your own preferences...
# ------------------------------------------------------------------------------------------------ #

[[ "${verbose:-false}" == "true" ]] && echo "in ~/.bashrc_wsl2"

# ------------------------------------------------------------------------------------------------ #
# WLS defaults
# ------------------------------------------------------------------------------------------------ #

# If set, the pattern "**" used in a pathname expansion context will match all files and zero or
# more directories and subdirectories.  shopt -s globstar

# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

# don't escape dollar.
shopt -s direxpand

# enable programmable completion features (you don't need to enable this, if it's already enabled in
# /etc/bash.bashrc and /etc/profile sources /etc/bash.bashrc).
if ! shopt -oq posix; then
  if [ -f /usr/share/bash-completion/bash_completion ]; then
    . /usr/share/bash-completion/bash_completion
  elif [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
  fi
fi
set show-all-if-ambiguous on

# Fix Kerberos
export KRB5CCNAME=FILE:/tmp/tgt

# Modules
source /usr/share/lmod/lmod/init/bash || echo "ERROR: lmod not installed."

# ------------------------------------------------------------------------------------------------ #
# Vendors, etc.
# ------------------------------------------------------------------------------------------------ #

# export SPACK_ROOT=~/devops-2025-05-15/dracose/spack
export SPACK_ROOT=${HOME}/dracose-tac/spack
export SPACK_USER_CACHE_PATH=${SPACK_ROOT}/.spack
export SPACK_DISABLE_LOCAL_CONFIG=true
export PYTHONDONTWRITEBYTECODE=1
export SPACK_COLOR=always
export SI_ARGS=-"-no-check-signature --use-buildcache auto"
export MIRROR_DIR=${HOME}/spack-mirror

if [[ -d $SPACK_ROOT ]]; then
  echo "==> found dracose-tac. Loading modules..."
  source $SPACK_ROOT/share/spack/setup-env.sh
  module use `\ls -d $SPACK_ROOT/share/spack/lmod/*/Core`
  module load ack catch2 cmake doxygen fmt ghostscript git gmake graphviz htop lcov mscgen ninja
  module load numdiff python qt random123 scnlib spdlog
  module load py-fprettify py-autopep8 py-cmake-format py-six py-flake8 py-sphinx
  module load py-sphinx-rtd-theme
fi
export SPACK_ROOT=${HOME}/dracose/spack
if [[ -d $SPACK_ROOT ]]; then
  echo "==> found dracose. Loading modules..."
  module use `\ls -d $SPACK_ROOT/share/spack/lmod/*/Core`
   # if [[ -n $(spack find llvm2 2>/dev/null) ]] ; then     echo "yes"; else     echo "no"; fi
  module load llvm
  module load boost eospac gsl hwloc lua metis openblas openmpi xsimd/8.0.5 xtensor-blas
  module load xtensor xtl caliper hdf5 hypre parmetis superlu-dist trilinos valgrind
  # module load ndi njoy-acetk njoy-fast-float njoy-tools ndatk mpark-variant avalanche
  # module load shacl-physics shacl-storm libquo

  # Keep access to clang-format and clang-format-diff.py even if llvm is unloaded.
  export PATH=$PATH:$(spack location -i llvm)/bin
  export PATH=$PATH:$(spack location -i llvm)/share/clang
  export SESAMEPATH=$HOME/physical_data/eos
fi

export OMP_NUM_THREADS=4

if [[ $(declare -f run &> /dev/null) != 0 ]]; then
   function run() {
     echo "==> $1";
     if [[ "${dry_run:-no}" == "no" ]]; then
        eval "$1";
     fi
   }
fi

if [[ -d "/mnt/c/Users/107638/AppData/Local/Programs/Microsoft VS Code" ]]; then
  export PATH=$PATH:"/mnt/c/Users/107638/AppData/Local/Programs/Microsoft VS Code"
fi

export LIBGL_ALWAYS_INDIRECT=1
export VENDOR_DIR=~/vendors

# Enable docker
export PATH=~/bin:$PATH

keychain

[[ "${verbose:-false}" == "true" ]] && echo "done with ~/.bash_wsl2"

# ------------------------------------------------------------------------------------------------ #
# End .bash_wls
# ------------------------------------------------------------------------------------------------ #
